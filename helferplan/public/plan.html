<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helferplan - Turnier-Planung</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        html, body { overflow-x: hidden; }
        .plan-main { max-width: 1400px; margin: 0 auto; padding: 20px; }
        /* Top panel with controls moved above timeline */
        .top-controls { 
            background: #f5f5f5; 
            padding: 16px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            display: flex; 
            gap: 30px; 
            align-items: flex-start;
            flex-wrap: wrap;
        }
        .control-group { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
            min-width: 200px;
        }
        .control-group h3 { 
            margin: 0; 
            font-size: 14px; 
            color: #005A9F; 
            border: none; 
            padding: 0;
        }
        .control-group select { 
            padding: 6px 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            font-size: 14px;
        }
        .team-list-panel { 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap;
            flex-direction: row; /* Make teams horizontal */
        }
        #helper-pool { 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap; 
            max-height: 200px; 
            overflow-y: auto;
        }
        /* Helper item with icons */
        .helper-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .helper-icon {
            font-size: 16px;
            display: inline-flex;
            align-items: center;
        }
        .plan-layout { display: block; }

        #plan-container { overflow-x: auto; flex: 1 1 auto; position: relative; }
        #timeline-header { position: sticky; top: 0; background: #fff; z-index: 10; display:block; }

        /* wichtig: alle relevant boxen box-sizing border-box */
        #timeline-header, #grid-container, .hour-slot, .shift-slot, .activity-name { box-sizing: border-box; }

        .hour-slot { font-size:12px; padding:4px 6px; text-align:center; background:#fafafa; }
        .shift-slot { font-size:12px; padding:6px; min-height:36px; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden; transition: transform .08s, outline .08s; }
        .shift-slot.filled { color:#fff; }

        .team-item .team-color { padding:6px 8px; border-radius:6px; color:#fff; font-weight:600; display:inline-block; white-space:nowrap; }

        .dimmed { opacity: .28; filter: grayscale(80%); }

        .shift-slot.potential-drop { outline:3px dashed rgba(33,150,243,0.9); transform: translateY(-1px); box-shadow:0 0 0 3px rgba(33,150,243,0.04) inset; }
        .shift-slot.drop-target { outline:3px solid rgba(33,150,243,0.95); transform: translateY(-2px); box-shadow:0 0 0 3px rgba(33,150,243,0.08) inset; }

        .slot-hidden { display:none !important; }

        /* die linke placeholder-zelle im header (falls sichtbar) auf transparent setzen */
        .left-placeholder { background: transparent !important; }

        /* Die linke Spalte (activity name) ist sticky, Teil des selben Grids */
        .activity-name {
            background: #fff;
            position: sticky;
            left: 0;
            z-index: 5;
            padding: 8px;
            border-right: 1px solid #e6e6e6;
            min-height: 36px;
            display:flex;
            align-items:center;
            font-weight:600;
            font-size: 11px; /* Smaller font */
        }

        /* Activity group headers sticky when scrolling horizontally */
        .activity-group-header { 
            padding:8px 0 4px 0; 
            font-weight:700; 
            grid-column:1 / -1; 
            background: #fff; 
            position: sticky; 
            left: 0; 
            z-index: 6;
            font-size: 12px; /* Smaller font */
        }
        #grid-container { overflow: visible; }
    </style>
</head>
<body>
<nav>
    <a href="index.html">Admin: Stammdaten</a>
    <a href="plan.html" class="active">Turnier-Planung</a>
    <a href="plan-admin.html">Turnier-Admin</a>
    <a href="aufbau-abbau.html">Auf-/Abbau</a>
    <a href="kuchen.html">Kuchen</a>
</nav>

<main class="plan-main">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h1 style="margin: 0;">Turnier-Planung (Fr 12:00 - So 17:00)</h1>
        <div style="display: flex; gap: 10px; align-items: center;">
            <span id="auth-status" style="display: none;"></span>
            <button id="write-mode-btn" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Bearbeitungsmodus</button>
            <button id="logout-btn" style="display: none; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Abmelden</button>
        </div>
    </div>
    
    <div class="top-controls">
        <div class="control-group">
            <h3>Teams</h3>
            <div id="team-list-panel" class="team-list-panel"></div>
        </div>

        <div class="control-group">
            <h3>Ansicht-Filter (nur Teamfarben)</h3>
            <select id="view-team-filter"><option value="">Alle Teams</option></select>
        </div>

        <div class="control-group">
            <h3>Wähle Team (Filter für Helfer)</h3>
            <select id="plan-team-filter"><option value="">-- Team wählen --</option></select>
        </div>

        <div class="control-group">
            <h3>Helfer (ziehen)</h3>
            <div id="helper-pool"><div id="helper-pool-empty">Wähle ein Team um Helfer anzuzeigen.</div></div>
        </div>
    </div>
    
    <div class="plan-layout">
        <div id="plan-container">
            <div id="timeline-header" aria-hidden="true"></div>
            <div id="grid-container" role="grid"></div>
        </div>
    </div>
</main>

<div id="shift-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h2 id="modal-title">Schicht besetzen</h2>
        <p id="modal-subtitle"></p>
        <form id="shift-form">
            <label for="modal-team-select">Team:</label>
            <select id="modal-team-select" required></select>
            <label for="modal-helper-select">Helfer:</label>
            <select id="modal-helper-select" required></select>
            <div class="modal-actions">
                <button type="submit" id="save-shift-button">Speichern</button>
                <button type="button" id="delete-shift-button" class="danger">Schicht leeren</button>
                <button type="button" id="cancel-shift-button">Abbrechen</button>
            </div>
        </form>
    </div>
</div>

<!-- Authentication Modal -->
<div id="auth-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h2>Anmeldung für Bearbeitungsmodus</h2>
        <p>Bitte geben Sie Ihren Namen und Ihre E-Mail-Adresse ein, um sich zu identifizieren.</p>
        <form id="auth-form" onsubmit="return false;">
            <label for="auth-name">Name:</label>
            <input type="text" id="auth-name" required style="width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;">
            
            <label for="auth-email">E-Mail:</label>
            <input type="email" id="auth-email" required style="width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;">
            
            <div id="auth-error" style="color: red; margin-bottom: 10px; min-height: 20px;"></div>
            
            <div class="modal-actions">
                <button type="button" id="auth-submit" style="background: #28a745;">Anmelden</button>
                <button type="button" id="auth-cancel">Abbrechen</button>
            </div>
        </form>
    </div>
</div>

<!-- Lade runtime config vor den App-Skripten -->
<script src="/helferplan/public/config.js"></script>
<script src="/helferplan/public/js/plan.js"></script>
</body>
</html>